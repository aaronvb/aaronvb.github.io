<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.0d48d3bcf21b70e49c10.css" id="gatsby-global-css">html{font-size:100}body{margin:0 0 0 calc(100vw - 100%);color:#222;line-height:1.625;font-size:1rem;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}body,h1,h2,h3,h4,h5,h6{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif}h1,h2,h3,h4,h5,h6{font-weight:600}h1{font-size:2.5rem;line-height:3.25rem;margin-top:6.5rem;margin-bottom:1.625rem}h2{font-size:1.6875rem;line-height:2.4375rem}h2,h3{margin-top:3.25rem;margin-bottom:.8125rem}h3{font-size:1.375rem;line-height:1.625rem}h4{font-size:1.2rem;margin-top:2.4375rem}h4,h5{line-height:1.625rem;margin-bottom:.8125rem}h5,h6{font-size:1rem;margin-top:4.0625rem}h6{line-height:1.625rem;margin-bottom:.8125rem}img{max-width:100%;margin:inherit auto}hr,img{border:0;display:block}hr{color:#222;height:1.625rem;margin:3.25rem auto;background-size:100% 26px;background-image:linear-gradient(180deg,transparent 1px,transparent 11px,#222 0,#222 15px,transparent 0,transparent 26px);width:6.25rem}a{color:#2e658f;text-decoration:none}a:active,a:focus,a:hover{color:#5ac18e}b,strong{font-weight:600}ul{list-style:square;margin-bottom:1.625rem}ul li{padding:0 .3125rem;margin-bottom:.625rem}p{line-height:1.625rem;margin-bottom:1.625rem}blockquote{padding:0;font-style:italic;text-align:center}figure{display:block;width:100%;height:auto}figcaption{line-height:1.21875rem;margin-top:.40625rem;color:#222;font-size:.75rem;font-style:italic;margin-bottom:0;text-align:center}.anchor{margin-left:-1.875rem!important;padding-right:.875rem!important}@media screen and (min-width:685px){figure.float-left,figure.float-right{max-width:19.375rem;padding:0 1.625rem}.float-right{float:right}.float-left{float:left}}code[class*=language-],pre[class*=language-]{font-size:12px;color:#f8f8f2;background:0 0;text-shadow:0 1px rgba(0,0,0,.3);font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#282a36}:not(pre)>code[class*=language-]{font-size:13px;padding:.3em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#6272a4}.token.punctuation{color:#f8f8f2}.namespace{opacity:.7}.token.constant,.token.deleted,.token.property,.token.symbol,.token.tag{color:#ff79c6}.token.boolean,.token.number{color:#bd93f9}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#50fa7b}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#f8f8f2}.token.atrule,.token.attr-value,.token.class-name,.token.function{color:#f1fa8c}.token.keyword{color:#8be9fd}.token.important,.token.regex{color:#ffb86c}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.Layout-module--layout--3Pyz6{max-width:66.875rem;margin-left:auto;margin-right:auto}.Layout-module--layout--3Pyz6:before{content:"";display:table}.Layout-module--layout--3Pyz6:after{content:"";display:table;clear:both}.Author-module--author--2Yefr{border-top:1px solid #e6e6e6;max-width:40rem;padding-top:1.25rem;line-height:1.625rem;margin-top:1.625rem;margin-bottom:3.25rem}.Author-module--author__bio-twitter--n-O9n{display:block;text-decoration:underline}@media screen and (min-width:685px){.Author-module--author--2Yefr{margin-left:auto;margin-right:auto}}.Content-module--content--3p512{max-width:59.0625rem;padding:0 1.25rem;margin:0 auto}.Content-module--content__title--2BDW9{margin-top:0;max-width:40rem;margin-left:auto;margin-right:auto;font-weight:600}.Content-module--content__body--2TrQ- figure{margin-bottom:1.625rem}.Content-module--content__body--2TrQ- figure blockquote{font-style:italic;text-align:center;margin-top:0;padding:1.625rem 0}.Content-module--content__body--2TrQ- figure blockquote p{max-width:40rem;font-size:1.1817rem;margin-top:0;margin-bottom:1.625rem;line-height:2.4375rem}.Content-module--content__body--2TrQ- a{text-decoration:underline}.Content-module--content__body--2TrQ- *{max-width:40rem;margin-left:auto;margin-right:auto}.Content-module--content__body--2TrQ- img{max-width:100%}@media screen and (min-width:960px){.Content-module--content--3p512{padding:0}.Content-module--content__body--2TrQ-,.Content-module--content__body--2TrQ- p{font-size:1rem;line-height:1.82813rem;margin-bottom:1.82813rem}}.Meta-module--meta__date--29eD7{font-style:italic}.Tags-module--tags--1L_ct{margin-bottom:.8125rem}.Tags-module--tags__list--91FqN{list-style:none;margin:0 -.625rem;padding:0}.Tags-module--tags__list-item--1M30P{display:inline-block;margin:.625rem .3125rem}.Tags-module--tags__list-item-link--3SL_8{display:inline-block;height:2.1875rem;padding:0 1.5rem;line-height:2.1875rem;border:1px solid #e6e6e6;text-decoration:none;border-radius:1.25rem;color:#222}.Tags-module--tags__list-item-link--3SL_8:focus,.Tags-module--tags__list-item-link--3SL_8:hover{color:#2e658f}.Post-module--post__comments--25y6I,.Post-module--post__footer--3WzWU{max-width:40rem;margin:0 auto;padding:0 1.25rem}@media screen and (min-width:960px){.Post-module--post__comments--25y6I,.Post-module--post__footer--3WzWU{padding:0}.Post-module--post__home-button--16Kl0{position:fixed;max-width:auto;margin:0;top:30px;left:30px}}.Author-module--author__title--3Vu60{font-size:1.125rem;font-weight:600;line-height:1.82813rem}.Author-module--author__title-link--3orkw,.Author-module--author__title-link--3orkw:focus,.Author-module--author__title-link--3orkw:hover{color:#222}@media screen and (min-width:685px){.Author-module--author--2X3SC{width:calc(33.3% - 1.25rem)}.Author-module--author--2X3SC:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Author-module--author--2X3SC:last-child{margin-right:0}.Author-module--author--2X3SC:nth-child(12n){margin-right:0;float:right}.Author-module--author--2X3SC:nth-child(12n+1){clear:both}}.Menu-module--menu__list-item-link--_5DwY{font-size:1rem;color:#222;font-weight:400;border:0}.Menu-module--menu__list-item-link--_5DwY:focus,.Menu-module--menu__list-item-link--_5DwY:hover{color:#2e658f;border-bottom:1px solid #2e658f}.Menu-module--menu__list-item-link--active--22put{color:#222;border-bottom:1px solid #222}.Menu-module--menu__list-item-link--_5DwY:not(:first-of-type){margin:0 0 0 1.625rem}.Topbar-module--topbar--xHw8-{max-width:40rem;margin-left:auto;margin-right:auto}.Topbar-module--topbar__inner--1dOQX{padding:0 1.25rem;margin-top:1.625rem;margin-bottom:2.4375rem}@media screen and (min-width:685px){.Topbar-module--topbar__inner--1dOQX{padding:0;margin-top:3.25rem;margin-bottom:3.25rem;line-height:1.8rem}}@media screen and (min-width:960px){.Topbar-module--topbar__inner--1dOQX{padding:0;margin-top:3.25rem;margin-bottom:3.25rem;line-height:1.8rem}}.Icon-module--icon--Gpyvw{display:inline-block;width:1em;height:1em;stroke-width:0;stroke:currentColor;fill:currentColor;font-style:normal;font-weight:400;speak:none;margin-right:.2em;text-align:center;font-variant:normal;text-transform:none;line-height:1em;margin-left:.2em;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.Contacts-module--contacts__list--3kMvi{display:flex;flex-flow:row wrap;flex-grow:0;flex-shrink:0;list-style:none;padding:0;margin:.625rem -.1875rem}.Contacts-module--contacts__list-item--3Cz7b{padding:0;margin:.25rem;display:flex;align-content:center;align-items:center;justify-content:center;height:2.1875rem;width:2.1875rem;line-height:2.1875rem;border-radius:50%;text-align:center;border:1px solid #ebebeb}.Contacts-module--contacts__list-item-link--2B4Ht{border:0;display:flex;color:#222}.Contacts-module--contacts__list-item-link--2B4Ht:focus,.Contacts-module--contacts__list-item-link--2B4Ht:hover{color:#2e658f}.About-module--about--Ip7_4{max-width:40rem;margin-left:auto;margin-right:auto}.About-module--about__inner--2VNJt{padding:0 1.25rem;margin-bottom:1.625rem}.About-module--about__inner--2VNJt figure{margin:0;padding:0}.About-module--about--Ip7_4 figure{margin:0 0 1rem 1rem;padding:0;float:right;width:9.375rem}.About-module--about--Ip7_4 figure img{border-radius:2%;background-clip:padding-box;width:9.375rem}.About-module--about__body--2M5ht a{color:#222;border-bottom:1px solid #bbb}.About-module--about__body--2M5ht a:focus,.About-module--about__body--2M5ht a:hover{color:#222;border-bottom:1px solid #222}@media screen and (min-width:685px){.About-module--about__inner--2VNJt{padding:0;margin-bottom:2.4375rem}.About-module--about__inner--2VNJt figure{margin:0 0 1rem 1rem;padding:0;width:12.5rem}.About-module--about__inner--2VNJt figure img{width:12.5rem}}@media screen and (min-width:960px){.About-module--about__inner--2VNJt{padding:0;margin-bottom:2.4375rem}.About-module--about__inner--2VNJt figure{margin:0 0 1rem 1rem;padding:0;width:12.5rem img;width-width:200px}}.Feed-module--feed__item--2D5rE{margin-bottom:.8125rem}.Feed-module--feed__item-title--3nigr{margin-top:0}.Feed-module--feed__item-title-link--iFMRs{color:#222;border-bottom:1px solid #bbb}.Feed-module--feed__item-title-link--iFMRs:focus,.Feed-module--feed__item-title-link--iFMRs:hover{color:#222;border-bottom:1px solid #222}.Feed-module--feed__item-meta-time--3t1fg{line-height:1.625rem;font-size:.75rem;color:#888;font-weight:600;text-transform:uppercase}.Feed-module--feed__item-meta-divider--N-Q0A{margin:0 .3125rem}.Feed-module--feed__item-meta-category-link--23f8F{font-size:.75rem;color:#5ac18e;font-weight:600;text-transform:uppercase}@media screen and (min-width:960px){.Feed-module--feed--37QKH{content:"";clear:both;display:table;min-width:640px}.Feed-module--feed__item--2D5rE{width:99.9%}.Feed-module--feed__item--2D5rE:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Feed-module--feed__item--2D5rE:last-child{margin-right:0}.Feed-module--feed__item--2D5rE:nth-child(1n){margin-right:0;float:right}.Feed-module--feed__item--2D5rE:nth-child(1n+1){clear:both}.Feed-module--feed__item-meta-time--3t1fg{width:calc(14.27143% - 1.60714rem)}.Feed-module--feed__item-meta-time--3t1fg:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Feed-module--feed__item-meta-time--3t1fg:last-child{margin-right:0}.Feed-module--feed__item-meta-time--3t1fg:nth-child(14n){margin-right:0;float:right}.Feed-module--feed__item-meta-time--3t1fg:nth-child(14n+1){clear:both}.Feed-module--feed__item-inner--1fgWN{width:calc(85.62857% - .26786rem)}.Feed-module--feed__item-inner--1fgWN:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Feed-module--feed__item-inner--1fgWN:last-child{margin-right:0}.Feed-module--feed__item-inner--1fgWN:nth-child(14n){margin-right:0;float:right}.Feed-module--feed__item-inner--1fgWN:nth-child(14n+1){clear:both}}.Copyright-module--copyright--1wsmF,.Daily-module--daily--2BsAZ{color:#b6b6b6;font-size:.75rem}.Daily-module--daily--2BsAZ{margin-bottom:.40625rem}.Footer-module--footer--VUGIP{max-width:40rem;margin-left:auto;margin-right:auto}.Footer-module--footer__inner--Meyx0{padding:0 1.25rem;margin-top:3.25rem;margin-bottom:1.625rem}@media screen and (min-width:685px){.Footer-module--footer__inner--Meyx0{padding:0;margin-top:3.25rem;margin-bottom:1.625rem}}@media screen and (min-width:960px){.Footer-module--footer__inner--Meyx0{padding:0;margin-top:3.25rem;margin-bottom:1.625rem}.Footer-module--footer__copyright--1jJLM{width:calc(49.95% - .9375rem)}.Footer-module--footer__copyright--1jJLM:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Footer-module--footer__copyright--1jJLM:last-child{margin-right:0}.Footer-module--footer__copyright--1jJLM:nth-child(2n){margin-right:0;float:right}.Footer-module--footer__copyright--1jJLM:nth-child(odd){clear:both}.Footer-module--footer__daily--Xh4hl{text-align:right}}.Page-module--page--2nMky{max-width:40rem;margin-left:auto;margin-right:auto;margin-bottom:1.625rem}.Page-module--page__inner--2M_vz{padding:0 1.25rem}.Page-module--page__title--GPD8L{margin:0;padding:0 0 1.625rem}@media screen and (min-width:685px){.Page-module--page__inner--2M_vz{padding:0}}@media screen and (min-width:960px){.Page-module--page__inner--2M_vz{padding:0}}.Articles-module--articles--2cRw9{max-width:40rem;margin-left:auto;margin-right:auto;margin-bottom:1.625rem}.Articles-module--articles__inner--3K8x1{padding:0 1.25rem}.Articles-module--articles--2cRw9 h4{margin:0;padding:1.625rem 0}@media screen and (min-width:685px){.Articles-module--articles__inner--3K8x1{padding:0;border-top:1px solid #e6e6e6}}@media screen and (min-width:960px){.Articles-module--articles__inner--3K8x1{padding:0;border-top:1px solid #e6e6e6}}.Projects-module--projects--lGaek{max-width:40rem;margin-left:auto;margin-right:auto;margin-bottom:1.625rem}.Projects-module--projects__inner--3DjHX{padding:0 1.25rem}.Projects-module--projects--lGaek h4{margin:0;padding:1.625rem 0}.Projects-module--projects--lGaek p:first-child{margin-top:0}.Projects-module--projects--lGaek a{color:#222;border-bottom:1px solid #bbb}.Projects-module--projects--lGaek a:focus,.Projects-module--projects--lGaek a:hover{color:#222;border-bottom:1px solid #222}@media screen and (min-width:685px){.Projects-module--projects__inner--3DjHX{padding:0;border-top:1px solid #e6e6e6;margin-bottom:2.4375rem}}@media screen and (min-width:960px){.Projects-module--projects__inner--3DjHX{padding:0;border-top:1px solid #e6e6e6;margin-bottom:2.4375rem}}.Contact-module--contact--1lFRw{max-width:40rem;margin-left:auto;margin-right:auto;margin-bottom:1.625rem}.Contact-module--contact__inner--1ri4q{padding:0 1.25rem}.Contact-module--contact--1lFRw h4{margin:0;padding:1.625rem 0}.Contact-module--contact--1lFRw p:first-child{margin-top:0}.Contact-module--contact--1lFRw a{color:#222;border-bottom:1px solid #bbb}.Contact-module--contact--1lFRw a:focus,.Contact-module--contact--1lFRw a:hover{color:#222;border-bottom:1px solid #222}@media screen and (min-width:685px){.Contact-module--contact__inner--1ri4q{padding:0;border-top:1px solid #e6e6e6;margin-bottom:2.4375rem}}@media screen and (min-width:960px){.Contact-module--contact__inner--1ri4q{padding:0;border-top:1px solid #e6e6e6;margin-bottom:2.4375rem}}</style><meta name="generator" content="Gatsby 2.32.12"/><link rel="alternate" type="application/rss+xml" title="Aaron Van Bokhoven - Software Developer" href="/rss.xml"/><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link rel="icon" href="/favicon-32x32.png?v=d2f3413ff13cfc81300c313cca06c226"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#2f3442"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=d2f3413ff13cfc81300c313cca06c226"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=d2f3413ff13cfc81300c313cca06c226"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=d2f3413ff13cfc81300c313cca06c226"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=d2f3413ff13cfc81300c313cca06c226"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=d2f3413ff13cfc81300c313cca06c226"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=d2f3413ff13cfc81300c313cca06c226"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=d2f3413ff13cfc81300c313cca06c226"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=d2f3413ff13cfc81300c313cca06c226"/><title data-react-helmet="true">Intro to Elasticsearch and Ruby on Rails, Part 1</title><meta data-react-helmet="true" name="description" content="An introduction to Elasticsearch and Ruby on Rails 4: searching, associations, and method values."/><meta data-react-helmet="true" property="og:site_name" content="Intro to Elasticsearch and Ruby on Rails, Part 1"/><meta data-react-helmet="true" property="og:image" content="https://aaronvb.com/photo.jpg"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:title" content="Intro to Elasticsearch and Ruby on Rails, Part 1"/><meta data-react-helmet="true" name="twitter:description" content="An introduction to Elasticsearch and Ruby on Rails 4: searching, associations, and method values."/><meta data-react-helmet="true" name="twitter:image" content="https://aaronvb.com/photo.jpg"/><link as="script" rel="preload" href="/webpack-runtime-499a7fb7cf537864a2ce.js"/><link as="script" rel="preload" href="/framework-11348fb0fa7c3ad87864.js"/><link as="script" rel="preload" href="/app-c2230dad2af5e5884cbf.js"/><link as="script" rel="preload" href="/styles-407fe62976dc5310c43e.js"/><link as="script" rel="preload" href="/1f823af0e43d2ea1b3adfb0e5988d39af11c1880-cecec868bda66c10d010.js"/><link as="script" rel="preload" href="/component---src-templates-post-template-js-90a71460442b7576229f.js"/><link as="fetch" rel="preload" href="/page-data/articles/intro-to-elasticsearch-ruby-on-rails-part-1/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/1251057998.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/251939775.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/401334301.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="Layout-module--layout--3Pyz6"><div class="Topbar-module--topbar--xHw8-"><div class="Topbar-module--topbar__inner--1dOQX"><div class="Author-module--author--2X3SC"><span class="Author-module--author__title--3Vu60"><a class="Author-module--author__title-link--3orkw" href="/">Aaron Van Bokhoven</a></span></div><nav><a href="/#articles" class="Menu-module--menu__list-item-link--_5DwY">Articles</a><a href="/#projects" class="Menu-module--menu__list-item-link--_5DwY">Projects</a><a href="/aaronvb_resume.pdf" class="Menu-module--menu__list-item-link--_5DwY">Resume</a><a href="/#contact" class="Menu-module--menu__list-item-link--_5DwY">Contact</a></nav></div></div><div><div><div class="Content-module--content--3p512"><h2 class="Content-module--content__title--2BDW9">Intro to Elasticsearch and Ruby on Rails, Part 1</h2><div class="Content-module--content__body--2TrQ-"><p>This will be a two-part guide on my first experiences with <a href="https://www.elastic.co/" target="_blank" rel="nofollow noopener noreferrer">Elasticsearch</a> and Ruby on Rails 4. I‚Äôve been a long time fan of <a href="https://lucene.apache.org/solr/" target="_blank" rel="nofollow noopener noreferrer">Solr</a>, and <a href="https://sunspot.github.io/" target="_blank" rel="nofollow noopener noreferrer">Sunspot</a> with Ruby on Rails, as Sunspot has always been easy to implement without a big learning curve. There‚Äôs also a lot of information out there for Sunspot.</p>
<p>Elasticsearch, on the other hand, seems to be less popular with Ruby on Rails. From my research, there were a few gems that were popular but are no longer active, and any google searches on information regarding them are dated at least a year back. It seems that the <a href="https://github.com/elasticsearch/elasticsearch-rails" target="_blank" rel="nofollow noopener noreferrer">go-to gem for Elasticsearch</a> is now from Elasticsearch itself, which actually consist of 3 separate gems.</p>
<p>In the first part, I will setup a basic search using the default Elasticsearch config, while also configuring the search of ActiveRecord associations and indexing a value obtained by a method. In the second part I will cover more advanced searches using custom analyzers and filters, such as ngram, edgengram, and lowercase filters on specific columns.</p>
<p>To get started, grab the latest Ruby on Rails, which at the time of this post is 4.1.6, and add these gems to your Gemfile. Notice we are only using two of the gems.</p>
<div class="gatsby-highlight" data-language="ruby"><pre class="language-ruby"><code class="language-ruby">gem <span class="token string">'elasticsearch-model'</span><span class="token punctuation">,</span>
  git<span class="token punctuation">:</span> <span class="token string">'git://github.com/elasticsearch/elasticsearch-rails.git'</span>
gem <span class="token string">'elasticsearch-rails'</span><span class="token punctuation">,</span>
  git<span class="token punctuation">:</span> <span class="token string">'git://github.com/elasticsearch/elasticsearch-rails.git'</span></code></pre></div>
<p>Some information on the two gems we are using taken from their Github repo:</p>
<ul>
<li>elasticsearch-model, which contains search integration for Ruby/Rails models such as ActiveRecord::Base and Mongoid</li>
<li>elasticsearch-rails, which contains various features for Ruby on Rails applications.</li>
</ul>
<p>We don‚Äôt need to use elasticsearch-persistence because elasticsearch-model will handle everything we need in our Ruby on Rails app.</p>
<p>The easiest way to install Elasticsearch is by using <a href="https://brew.sh/" target="_blank" rel="nofollow noopener noreferrer">Homebrew</a>, which I hope you are already using.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">> brew install elasticsearch
> elasticsearch --config=/usr/local/opt/elasticsearch/config/elasticsearch.yml</code></pre></div>
<p>By default, our Rails app will connect to Elasticsearch at localhost:9200, but if you need to connect to a different server, create a .rb file in your config/initializers and add this.</p>
<div class="gatsby-highlight" data-language="ruby"><pre class="language-ruby"><code class="language-ruby"><span class="token comment"># config/initializers/elasticsearch.rb</span>
<span class="token comment"># ENV['ELASTICSEARCH_ADDRESS_INT'] is the environment variable</span>
<span class="token comment"># for the elasticsearch server, replace with IP address if not using ENV</span>
<span class="token constant">User</span><span class="token punctuation">.</span>__elasticsearch__<span class="token punctuation">.</span>client <span class="token operator">=</span> <span class="token constant">Elasticsearch</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Client</span><span class="token punctuation">.</span><span class="token keyword">new</span> host<span class="token punctuation">:</span> <span class="token constant">ENV</span><span class="token punctuation">[</span><span class="token string">'ELASTICSEARCH_ADDRESS_INT'</span><span class="token punctuation">]</span></code></pre></div>
<p>Alright, so if you haven‚Äôt already figured it out from the code above, we‚Äôre going to be searching a <em>User</em> model. Create a User table if you don‚Äôt already have one, and make sure it has a first name and email column.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">> rails g model user first_name:string email:string
> rake db:migrate</code></pre></div>
<p>Open the model file at <em>app/models/user.rb</em>, and add the Elasticsearch includes. This will allow us to use the Elasticsearch methods on our model, and will also enable the Elasticsearch callbacks for events such as creating, updating, and destroying our model objects, which will keep the Elasticsearch index up to date.</p>
<div class="gatsby-highlight" data-language="ruby"><pre class="language-ruby"><code class="language-ruby"><span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token operator">&lt;</span> <span class="token constant">ActiveRecord</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Base</span>
  <span class="token keyword">include</span> <span class="token constant">Elasticsearch</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Model</span>
  <span class="token keyword">include</span> <span class="token constant">Elasticsearch</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Model</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Callbacks</span>
<span class="token keyword">end</span></code></pre></div>
<p>That‚Äôs pretty much all you need to do to start searching the User model. By default this will search all the columns in this model. Open up the rails console to see how easy it is.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">> rails c
Loading development environment (Rails 4.1.6)
irb(main):001:0> User.import
=> 0
irb(main):001:0> User.search("aaron").results.count
=> 10</code></pre></div>
<p>One thing you‚Äôll notice is the <em>import</em> method that I‚Äôm calling on the User model. This is needed because our search index is empty and we need to populate it with our current data. Any subsequent changes to the User table will automatically be added to the index by the Elasticsearch callbacks, so you wont need to run the import method again, unless changes are made outside of the Rails app.</p>
<p>If you read up on the documentation, you‚Äôll be able to do some neat things like find the score each result. One thing I want to mention is that if you use the <em>records</em> method instead of the <em>results</em> method, you will get a collection of ActiveRecord objects instead of Elasticsearch objects.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">irb(main):001:0> User.search("aaron").results.first
=> #&lt;Elasticsearch::Model::Response::Result:0x007fd200e71380 @result=#&lt;Hashie::Mash _id="155" _index="users" _score=0.5878618...
> User.search("aaron").results.first._score
=> 0.5878618
> User.search("aaron").records.first
=> #&lt;User id: 155, first_name: "aaron", email: "bokhoven@gmail.com"...</code></pre></div>
<p>Cool, so now we can search our User table. But what if we have associations that need to be searched as well? Elasticsearch has a model function for that. Let‚Äôs start by creating our association model: PhoneNumber, and adding the associations to our models.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">> rails g model phone_number number:string user_id:integer
> rake db:migrate</code></pre></div>
<div class="gatsby-highlight" data-language="ruby"><pre class="language-ruby"><code class="language-ruby"><span class="token keyword">class</span> <span class="token class-name">PhoneNumber</span> <span class="token operator">&lt;</span> <span class="token constant">ActiveRecord</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Base</span>
  belongs_to <span class="token symbol">:user</span>
<span class="token keyword">end</span></code></pre></div>
<div class="gatsby-highlight" data-language="ruby"><pre class="language-ruby"><code class="language-ruby"><span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token operator">&lt;</span> <span class="token constant">ActiveRecord</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Base</span>
  <span class="token keyword">include</span> <span class="token constant">Elasticsearch</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Model</span>
  <span class="token keyword">include</span> <span class="token constant">Elasticsearch</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Model</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Callbacks</span>

  has_many <span class="token symbol">:phone_numbers</span>
<span class="token keyword">end</span></code></pre></div>
<p>Now we need to configure how Elasticsearch creates the index document for each object. In our <em>User</em> model add this function.</p>
<div class="gatsby-highlight" data-language="ruby"><pre class="language-ruby"><code class="language-ruby"><span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token operator">&lt;</span> <span class="token constant">ActiveRecord</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Base</span>
  <span class="token keyword">include</span> <span class="token constant">Elasticsearch</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Model</span>
  <span class="token keyword">include</span> <span class="token constant">Elasticsearch</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Model</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Callbacks</span>

  has_many <span class="token symbol">:phone_numbers</span>

  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">as_indexed_json</span></span><span class="token punctuation">(</span>options<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    as_json<span class="token punctuation">(</span>
      only<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token symbol">:id</span><span class="token punctuation">,</span> <span class="token symbol">:first_name</span><span class="token punctuation">,</span> <span class="token symbol">:email</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token keyword">include</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token symbol">:phone_numbers</span><span class="token punctuation">]</span>
    <span class="token punctuation">)</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span></code></pre></div>
<p>I‚Äôll explain what‚Äôs going on here. When Elasticsearch indexes our User object, we are telling it that we only want to search the id, first name, and email attribute, and all phone numbers associated with this object. To better visualize what the document looks like, open up the rails console.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">> rails c
irb(main):001:0> User.first.as_indexed_json
=> {"id"=>1, "email"=>"bokhoven@gmail.com", "first_name"=>"aaron",
  "phone_numbers"=>[{"id"=>1, "user_id"=>1, "number"=>"123-456-7890"}]}]}</code></pre></div>
<p>Note, when we search for a Phone Number, we aren‚Äôt searching a separate phone number index, we are still searching our User index that has a collection of phone numbers.</p>
<blockquote>
<p>Elasticsearch, like most NoSQL databases, treats the world as though it were flat. An index is a flat collection of independent documents. A single document should contain all of the information that is required to decide whether it matches a search request or not.</p>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/relations.html" target="_blank" rel="nofollow noopener noreferrer">Elasticsearch Relations</a></li>
</ul>
</blockquote>
<p>To create a separate Phone Number index and have Elasticsearch emulate the association, look into <a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/nested-objects.html" target="_blank" rel="nofollow noopener noreferrer">Nested Objects</a>. While both have their advantages and disadvantages, sticking with the flat document will work well most of the time. Possibly in another article I will go over Nested Objects.</p>
<p>Let‚Äôs rebuilt and test our new search index.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">irb(main):001:0> User.import
=> 0
> query = User.search("123-456-7890").records.first
=> #&lt;User id: 155, first_name: "aaron", email: "bokhoven@gmail.com"...
> query.phone_numbers.first
=> #&lt;ActiveRecord::Associations::CollectionProxy [#&lt;PhoneNumber id: 1, user_id: 155, number: "123-456-7890">]></code></pre></div>
<p>Easy, everything works. Not quite. When using associations, it‚Äôs not a good idea to use the <em>records</em> method on the search object. The reason for this is because the collection of records from the search object are ActiveRecord objects, and using the phone numbers method on it will cause ActiveRecord to look up each phone number object for each search record. What you want to use is the <em>results</em> method on the search object, this will use the ‚Äúflat‚Äù document and not create any more queries for the phone numbers as they are included in the results object. To make this clearer, I‚Äôll show you an example.</p>
<p>This is with records.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">irb(main):001:0> User.search("aaron").records.first
  User Search (10.1ms) {index: "users", type: "user", q: "aaron"}
  User Load (3.0ms)  SELECT "users".* FROM "users"  WHERE "users"."id" IN (155, 156, 157, 158)
=> #&lt;User id: 155, first_name: "aaron", email: "bokhoven@gmail.com"...

> User.search("aaron").records.first.phone_numbers
  User Search (10.1ms) {index: "users", type: "user", q: "aaron"}
  User Load (3.0ms)  SELECT "users".* FROM "users"  WHERE "users"."id" IN (155, 156, 157, 158)
  PhoneNumber Load (2.9ms)  SELECT "phone_numbers".* FROM "phone_numbers"  WHERE "phone_numbers"."user_id" = $1  [["user_id", 155]]
=> #&lt;ActiveRecord::Associations::CollectionProxy [#&lt;PhoneNumber id: 1, user_id: 155, number: "123-456-7890"...</code></pre></div>
<p>You can see that another call was made to the PhoneNumber model because we‚Äôre calling the phone_numbers method on the User ActiveRecord object which was in the <em>records</em> collection.</p>
<p>This is with results.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">irb(main):001:0> User.search("aaron").results.first
  User Search (10.1ms) {index: "users", type: "user", q: "aaron"}
=> #&lt;Hashie::Mash id: 155, first_name: "aaron", email: "bokhoven@gmail.com"...

> User.search("aaron").records.first.phone_numbers
  User Search (10.1ms) {index: "users", type: "user", q: "aaron"}
=> #&lt;Hashie::Mash id: 155, first_name: "aaron", email: "bokhoven@gmail.com", phone_numbers=[#&lt;Hashie::Mash number="123-456-7890"...</code></pre></div>
<p>With that said, let‚Äôs move on to the last topic I wanted to cover, adding values to the search document that are created by a method in the model. An example of this could be a <em>full name</em> method that returns a first and last name column together. It makes more sense to search the full name value instead of both columns separately. We‚Äôll use that example in our app.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">> rails g migration add_last_name_to_users last_name:string
> rake db:migrate</code></pre></div>
<div class="gatsby-highlight" data-language="ruby"><pre class="language-ruby"><code class="language-ruby"><span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token operator">&lt;</span> <span class="token constant">ActiveRecord</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Base</span>
  <span class="token keyword">include</span> <span class="token constant">Elasticsearch</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Model</span>
  <span class="token keyword">include</span> <span class="token constant">Elasticsearch</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Model</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Callbacks</span>

  has_many <span class="token symbol">:phone_numbers</span>

  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">full_name</span></span>
    <span class="token string">"<span class="token interpolation"><span class="token delimiter tag">#{</span>first_name<span class="token delimiter tag">}</span></span> <span class="token interpolation"><span class="token delimiter tag">#{</span>last_name<span class="token delimiter tag">}</span></span>"</span>
  <span class="token keyword">end</span>

  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">as_indexed_json</span></span><span class="token punctuation">(</span>options<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    as_json<span class="token punctuation">(</span>
      only<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token symbol">:id</span><span class="token punctuation">,</span> <span class="token symbol">:full_name</span><span class="token punctuation">,</span> <span class="token symbol">:email</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token keyword">include</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token symbol">:phone_numbers</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      methods<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token symbol">:full_name</span><span class="token punctuation">]</span>
    <span class="token punctuation">)</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span></code></pre></div>
<p>I added the <em>full_name</em> method to our User model, and then modified the as_indexed_json method to include the full_name method, and also added it to the document by including it in the <em>only</em> collection. You can always double check what the document looks like by calling the the as_indexed_json method on a User model, I explained how earlier in this article.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">irb(main):001:0> User.search("aaron van bokhoven").results.first
=> #&lt;Hashie::Mash id: 155, full_name: "aaron van bokhoven", email: "bokhoven@gmail.com"...</code></pre></div>
<p>This is the end of the first part. Elasticsearch is a powerful tool and I‚Äôve only just begun to scratch the surface. Stay tuned for my next part on customizing Elasicsearch to use analyzers and filters.</p></div></div></div><div class="Post-module--post__footer--3WzWU"><div><p class="Meta-module--meta__date--29eD7">Published <!-- -->17<!-- --> <!-- -->Oct<!-- --> <!-- -->2014</p></div><div class="Tags-module--tags--1L_ct"><ul class="Tags-module--tags__list--91FqN"><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/code/">Code</a></li><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/elasticsearch/">Elasticsearch</a></li><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/ruby-on-rails/">Ruby on Rails</a></li><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/guide/">Guide</a></li></ul></div><div class="Author-module--author--2Yefr"><p>Software developer working with Ruby, Go, and JavaScript. Hobbyist street photographer and climber.</p><p><a class="Author-module--author__bio-twitter--n-O9n" href="https://twitter.com/aaronvb" rel="noopener noreferrer" target="_blank"><strong>Aaron Van Bokhoven</strong> on Twitter</a></p></div></div><div class="Post-module--post__comments--25y6I"><div id="inject-comments-for-uterances"></div></div></div><div class="Footer-module--footer--VUGIP"><div class="Footer-module--footer__inner--Meyx0"><div class="Footer-module--footer__copyright--1jJLM"><div class="Copyright-module--copyright--1wsmF">¬©2020 Aaron Van Bokhoven</div></div><div class="Footer-module--footer__daily--Xh4hl"><div class="Daily-module--daily--2BsAZ">Happy Weekend, rest well. üò¥</div></div></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/articles/intro-to-elasticsearch-ruby-on-rails-part-1";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-1710eb3daa040b8ff904.js"],"app":["/app-c2230dad2af5e5884cbf.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-b0556ce5127c1a3e2490.js"],"component---src-templates-category-template-js":["/component---src-templates-category-template-js-9a43d30fbb16ee02cd3f.js"],"component---src-templates-index-template-js":["/component---src-templates-index-template-js-b5fead081561ab4b9ed5.js"],"component---src-templates-not-found-template-js":["/component---src-templates-not-found-template-js-1bebd62000e4526ad3c3.js"],"component---src-templates-post-template-js":["/component---src-templates-post-template-js-90a71460442b7576229f.js"],"component---src-templates-tag-template-js":["/component---src-templates-tag-template-js-5ab9dc0232ae8b2049ac.js"]};/*]]>*/</script><script src="/polyfill-1710eb3daa040b8ff904.js" nomodule=""></script><script src="/component---src-templates-post-template-js-90a71460442b7576229f.js" async=""></script><script src="/1f823af0e43d2ea1b3adfb0e5988d39af11c1880-cecec868bda66c10d010.js" async=""></script><script src="/styles-407fe62976dc5310c43e.js" async=""></script><script src="/app-c2230dad2af5e5884cbf.js" async=""></script><script src="/framework-11348fb0fa7c3ad87864.js" async=""></script><script src="/webpack-runtime-499a7fb7cf537864a2ce.js" async=""></script></body></html>
{"componentChunkName":"component---src-templates-post-template-js","path":"/articles/adding-a-simple-search-in-5-minutes-to-a-ruby-on-rails-site","result":{"data":{"markdownRemark":{"id":"4b60af45-a5b2-5f5e-92c6-83a609f30300","html":"<p>Prototyping a site in Ruby on Rails and need to add a simple search feature in less than 5 minutes?</p>\n<p>Note: This should be for smaller projects because I’ll be using regular SQL queries for searching. If you’re looking for something more advanced, try <a href=\"https://freelancing-gods.com/thinking-sphinx/v4/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">thinking_sphinx(sphinx engine)</a> or <a href=\"https://sunspot.github.io/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">sunspot_solr(java lucene solr engine)</a>.</p>\n<p>I’ll be using <a href=\"https://github.com/binarylogic/searchlogic\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Searchlogic</a> and <a href=\"https://github.com/mislav/will_paginate\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">will_paginate</a> in this demo.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\">#install searchlogic</span>\nsudo gem install searchlogic\n\n<span class=\"token comment\">#install will_paginate</span>\ngem sources <span class=\"token operator\">-</span>a http<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>gemcutter<span class=\"token punctuation\">.</span>org\nsudo gem install will_paginate</code></pre></div>\n<p>Then add the gem to the environment file.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\">#config/environment.rb</span>\n\nconfig<span class=\"token punctuation\">.</span>gem <span class=\"token string\">\"binarylogic-searchlogic\"</span><span class=\"token punctuation\">,</span> <span class=\"token symbol\">:lib</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token string\">\"searchlogic\"</span>\nconfig<span class=\"token punctuation\">.</span>gem <span class=\"token string\">'will_paginate'</span><span class=\"token punctuation\">,</span> <span class=\"token symbol\">:version</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token string\">'~> 2.3.11'</span></code></pre></div>\n<p>If you prefer to use github or the plugin version, check out <a href=\"https://rdoc.info/projects/binarylogic/searchlogic\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">their docs</a>. I also suggest reading their docs to learn more about all the neat functions Searchlogic can do. It’s a very powerful and useful plugin.</p>\n<p>We’ll be adding the search to Posts, so let’s start by adding the search route to our posts.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\">#config/routes.rb</span>\n\nmap<span class=\"token punctuation\">.</span>resources <span class=\"token symbol\">:posts</span><span class=\"token punctuation\">,</span> <span class=\"token symbol\">:collection</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span> <span class=\"token symbol\">:search</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span> <span class=\"token symbol\">:post</span><span class=\"token punctuation\">,</span> <span class=\"token symbol\">:get</span> <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span></code></pre></div>\n<p>This will give you the path /posts/search GET and POST.</p>\n<p>Next add the search method to the PostsController.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\">#app/controllers/posts_controller.rb</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">PostsController</span> <span class=\"token operator\">&lt;</span> <span class=\"token constant\">ApplicationController</span>\n\n  <span class=\"token keyword\">def</span> <span class=\"token method-definition\"><span class=\"token function\">index</span></span>\n    <span class=\"token variable\">@posts</span> <span class=\"token operator\">=</span> <span class=\"token constant\">Post</span><span class=\"token punctuation\">.</span>paginate<span class=\"token punctuation\">(</span><span class=\"token symbol\">:all</span><span class=\"token punctuation\">,</span> <span class=\"token symbol\">:order</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token string\">'created_at desc'</span><span class=\"token punctuation\">,</span> <span class=\"token symbol\">:per_page</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token number\">25</span><span class=\"token punctuation\">,</span> <span class=\"token symbol\">:page</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> params<span class=\"token punctuation\">[</span><span class=\"token symbol\">:page</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">end</span>\n\n  <span class=\"token keyword\">def</span> <span class=\"token method-definition\"><span class=\"token function\">search</span></span>\n    <span class=\"token keyword\">if</span> request<span class=\"token punctuation\">.</span>post<span class=\"token operator\">?</span>\n\n      <span class=\"token comment\">#pass the post into a get with the 'q' param</span>\n      redirect_to search_posts_path<span class=\"token punctuation\">(</span><span class=\"token symbol\">:q</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> params<span class=\"token punctuation\">[</span><span class=\"token symbol\">:search</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token symbol\">:query</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">elsif</span> request<span class=\"token punctuation\">.</span>get<span class=\"token operator\">?</span>\n\n      <span class=\"token keyword\">unless</span> params<span class=\"token punctuation\">[</span><span class=\"token symbol\">:q</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>blank<span class=\"token operator\">?</span>\n\n        <span class=\"token comment\">#Searchlogics title_like_all to search within titles in the Post model for any of the words in the query.</span>\n        <span class=\"token comment\">#words in the string are split into an array by spaces</span>\n        search <span class=\"token operator\">=</span> <span class=\"token constant\">Post</span><span class=\"token punctuation\">.</span>title_like_all<span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">[</span><span class=\"token symbol\">:q</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>to_s<span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>descend_by_created_at\n\n        <span class=\"token comment\">#paginate the results</span>\n        <span class=\"token variable\">@posts</span> <span class=\"token operator\">=</span> search<span class=\"token punctuation\">.</span>paginate<span class=\"token punctuation\">(</span><span class=\"token symbol\">:per_page</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token number\">25</span><span class=\"token punctuation\">,</span> <span class=\"token symbol\">:page</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> params<span class=\"token punctuation\">[</span><span class=\"token symbol\">:page</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token comment\">#pass the query object to the view to let the user know what they searched for</span>\n        <span class=\"token variable\">@query</span> <span class=\"token operator\">=</span> params<span class=\"token punctuation\">[</span><span class=\"token symbol\">:q</span><span class=\"token punctuation\">]</span>\n\n      <span class=\"token keyword\">end</span>\n\n      <span class=\"token comment\">#render the Post index.html.erb</span>\n      render <span class=\"token string\">'index'</span>\n\n    <span class=\"token keyword\">end</span>\n  <span class=\"token keyword\">end</span>\n\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>The last part is the search form in your view.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token operator\">&lt;</span>p<span class=\"token operator\">></span>\n\t<span class=\"token operator\">&lt;</span><span class=\"token operator\">%</span> form_for <span class=\"token symbol\">:search</span><span class=\"token punctuation\">,</span> <span class=\"token symbol\">:url</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span> <span class=\"token symbol\">:controller</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token string\">'posts'</span><span class=\"token punctuation\">,</span> <span class=\"token symbol\">:action</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token string\">'search'</span> <span class=\"token punctuation\">}</span> <span class=\"token keyword\">do</span> <span class=\"token operator\">|</span>f<span class=\"token operator\">|</span> <span class=\"token string\">%>\n\t\t&lt;%= f.text_field :query, :value =></span> <span class=\"token variable\">@query</span><span class=\"token string\">%>\n\t\t&lt;%= f.submit \"Search\", :disable_with =></span> <span class=\"token string\">\"Searching...\"</span>  <span class=\"token string\">%>\n\t&lt;% end %></span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>p<span class=\"token operator\">></span></code></pre></div>","fields":{"slug":"/articles/adding-a-simple-search-in-5-minutes-to-a-ruby-on-rails-site","tagSlugs":["/tag/code/","/tag/ruby-on-rails/"]},"frontmatter":{"date":"2009-10-24","description":"Prototyping a site in Ruby on Rails and need to add a simple search feature in less than 5 minutes?","tags":["Code","Ruby on Rails"],"title":"Adding A Simple Search In 5 Minutes to a Ruby on Rails Site"}}},"pageContext":{"slug":"/articles/adding-a-simple-search-in-5-minutes-to-a-ruby-on-rails-site"}},"staticQueryHashes":["1251057998","251939775","401334301"]}